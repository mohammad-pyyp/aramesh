{% load static %}
<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <title>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100">

    <div id="app" class="max-w-md mx-auto mt-10 p-6 bg-white border rounded-xl shadow">
        <h2 class="text-2xl font-bold mb-4 text-center">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>

        <!-- Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
        <div class="mb-3">
            <label class="block mb-1 font-medium">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
            <input v-model="phone" type="text" placeholder="09xxxxxxxxx" class="w-full border rounded p-2" />
        </div>

        <!-- Ù†Ø§Ù… -->
        <div class="mb-3">
            <label class="block mb-1 font-medium">Ù†Ø§Ù…</label>
            <input v-model="firstName" type="text" class="w-full border rounded p-2" />
        </div>

        <!-- Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ -->
        <div class="mb-3">
            <label class="block mb-1 font-medium">Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
            <input v-model="lastName" type="text" class="w-full border rounded p-2" />
        </div>

        <!-- OTP -->
        <div class="mb-3" v-if="otpSent">
            <label class="block mb-1 font-medium">Ú©Ø¯ OTP</label>
            <input v-model="otp" type="text" maxlength="6" class="w-full border rounded p-2" />
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
        <div class="flex gap-2 mt-4">
            <button @click="sendOtp" class="flex-1 bg-blue-600 text-white rounded p-2" :disabled="loading">
                Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯
            </button>

            <button v-if="otpSent" @click="register" class="flex-1 bg-green-600 text-white rounded p-2"
                :disabled="loading">
                Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
            </button>
        </div>

        <!-- Ù¾ÛŒØ§Ù… -->
        <p v-if="message" class="mt-4 text-center text-sm text-gray-700">
            {{ message }}
        </p>
    </div>

    <script src="{% static 'js/client.js' %}"></script>
    <script>
        const { createApp, ref } = Vue;

        createApp({
            setup() {
                const phone = ref("");
                const firstName = ref("");
                const lastName = ref("");
                const otp = ref("");
                const otpSent = ref(false);
                const message = ref("");
                const loading = ref(false);


                const sendOtp = async () => {
                    loading.value = true;
                    message.value = "";
                    try {
                        await sessionClient.sendOTP(phone.value, "register");
                        otpSent.value = true;
                        message.value = "Ú©Ø¯ OTP Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.";
                    } catch (err) {
                        message.value = err.response?.data?.message || "Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯";
                    } finally {
                        loading.value = false;
                    }
                };

                const register = async () => {
                    loading.value = true;
                    message.value = "";
                    try {
                        await sessionClient.register(
                            phone.value,
                            otp.value,
                            firstName.value,
                            lastName.value
                        );
                        message.value = "Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ ğŸ‰";
                    } catch (err) {
                        message.value = err.response?.data?.message || "Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…";
                    } finally {
                        loading.value = false;
                    }
                };

                return { phone, firstName, lastName, otp, otpSent, message, loading, sendOtp, register };
            },
        }).mount("#app");
    </script>

</body>

</html>